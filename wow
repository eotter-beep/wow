#!/usr/bin/env python3
"""
  The Wow! compiler â€” built by amazing people like eotter->
"""
import os
from pycparser import c_parser

path = input("Enter a path (full path): ").strip()
print(f"Compiling {path}...")

# Safely read the file
try:
    with open(path, "r") as f:
        content = f.read()
except FileNotFoundError:
    print(f"Error: file '{path}' not found.")
    exit(1)

# Strip out preprocessor directives which pycparser can't >
sanitized_lines = []
for line in content.splitlines():
    if line.lstrip().startswith("#"):
        sanitized_lines.append("")
    else:
        sanitized_lines.append(line)
sanitized_content = "\n".join(sanitized_lines)

# Parse C code into an AST
parser = c_parser.CParser()
try:
    ast = parser.parse(sanitized_content, filename=path)
except Exception as e:
    print(f"Parsing error: {e}")
    exit(1)

# Display the AST
ast.show()
os.system(f'python3 "{path}"')
